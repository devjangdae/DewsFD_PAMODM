<!--##3460e248-0b54-4b02-bd7f-35b627dc99c7##-->
<!--##PAMODM01800##-->
<!--##NfXzTXQNVMHOAn1qsSKKDezy6BiTpBWsoK1vrxaWtbI=##-->
<!--
  DEWS UI/UX IDE - Build Result - v1.5
  # PageID: PAMODM01800
  # PageTitle: [한국동서발전]행사참가직원등록
  # Server: http://localhost:8090/
-->
<!--

-->

<div id="conditionpanel1" class="dews-ui-condition-panel">
  <ul class="required-area">
    <li>
      <label class="dews-ui-multilingual">사업장</label>
      <span>
        <input type="text" id="cdp1" name="cdp1" class="dews-ui-codepicker" data-dews-help-code="H_MA_COMPANY_S" data-dews-code-field="COMPANY_CD" data-dews-text-field="COMPANY_NM" data-dews-help-title="회사 도움창" data-dews-help-custom="false" data-dews-help-size="medium" data-dews-use-keyword="false" />
      </span>
    </li>
    <li>
      <label class="dews-ui-multilingual">부서</label>
      <span>
        <select id="mcdp1" name="mcdp1" class="dews-ui-multicodepicker" data-dews-help-code="H_MA_DEPT_MST_S" data-dews-code-field="DEPT_CD" data-dews-text-field="DEPT_NM" data-dews-help-title="부서 도움창" data-dews-help-custom="false" data-dews-help-size="medium" />
      </span>
    </li>
    <li>
      <label class="dews-ui-multilingual">기간</label>
      <span>
        <span id="pp1" class="dews-ui-periodpicker basic"></span>
      </span>
    </li>
  </ul>
  <ul class="optional-area">
    <li>
      <label class="dews-ui-multilingual">라벨</label>
      <span>
        <select id="ddl1" name="ddl1" class="dews-ui-dropdownlist basic" data-dews-value-field="SYSDEF_CD" data-dews-text-field="SYSDEF_NM" data-dews-show-tooltip="true" data-dews-option-label-value="" data-dews-option-label-text="" data-dews-show-value-tooltip="true" data-dews-use-numkey="false"></select>
      </span>
    </li>
  </ul>
</div>
<div id="containerpanel1" class="dews-ui-container-panel" data-dews-fit-bottom="true">
  <div id="containerpanelitem1" class="dews-container-item" data-dews-position="normal">
    <div id="grid1" class="dews-ui-grid"></div>
  </div>
</div>

<style>
    
</style>



<script>
  dews.ready(function () {
    var self = this;
    self.version = self.version || {};
    self.version.view='1.0';


    /*b0c72068-ba69-4099-9af5-d9863bacd226*/ //self.cdp1~~~
    
    // 메인버튼 삭제 버튼의 기본 확인 메시지 사용 여부 설정
    self.mainButtons.delete.useDefaultConfirm = false;
    
    
    
    
    
    self.ds1 = dews.ui.dataSource('ds1', {
      grid: true,
      transport: {
        read: {
          type: 'post',
          url: dews.url.getApiUrl('HR', 'PAMODM01800Service', 'pamodm01800_listMaster'),
          data: function () {
            return {
              start_dt: self.pp1.getStartDate(),
              end_dt: self.pp1.getEndDate(),
              dept_cd: self.mcdp1.codes().join('|'),
              company_cd: self.cdp1.code(),
              dof_tp: self.ddl1.value()
            };
          }
        }
      },
      schema: {
        model: {
          fields: [
            { field: 'EMP_NO', editable: false, dataType: 'string' }, 
            { field: 'KOR_NM', editable: false, dataType: 'string' }, 
            { field: 'DEPT_CD', editable: false, dataType: 'string' }, 
            { field: 'OGRP_CD', editable: false, dataType: 'string' }, 
            { field: 'PSTN_CD', editable: false, dataType: 'string' }, 
            { field: 'JNCO_DT', editable: false, dataType: 'string' }, 
            { field: 'MNG_DC93', editable: false, dataType: 'string' }, 
            { field: 'MNG_DC50', editable: false, dataType: 'string' }, 
            { field: 'START_DT', editable: false, dataType: 'string' }, 
            { field: 'END_DT', editable: false, dataType: 'string' }, 
            { field: 'TM_CD_NM', editable: false, dataType: 'string' }, 
            { field: 'DOF_TP', editable: false, dataType: 'string' }, 
            { field: 'START_TM', editable: false, dataType: 'string' }, 
            { field: 'END_TM', editable: false, dataType: 'string' }, 
            { field: 'DOF_TM_CNT', editable: false, dataType: 'number' }, 
            { field: 'LVE_TM_CNT', editable: false, dataType: 'number' }
          ]
    
        }
      }
    });
    dews.api.get(dews.url.getApiUrl('CM', 'CommonCodeDtlService', 'common_ci_codeDtl_list'),{
      async: false,
      data: {
          end_dt: '',
          foreign_yn: '',
          field_cd_pipe: 'ZC01_10005',
          module_cd: 'HR',
          syscode_yn: '',
          keyword: '',
          base_yn: ''
      }
    }).done(function (data) {
      var ar_ZC01_10005 = new Array();
    
      for (var i = 0; i < data.length; i++) {
        if (data[i].FIELD_CD == "ZC01_10005") { 
          ar_ZC01_10005.push(data[i]); 
    
        }
      }
      self.pipeData_ZC01_10005 = dews.ui.dataSource('pipeData_ZC01_10005',  { data: ar_ZC01_10005 });
      self.pipeData = dews.ui.dataSource('pipeData', { data: data });
      
    });
    
    
    dews.ui.mainbuttons.localize.disable(true);
    dews.ui.mainbuttons.add.click(/*d1cbdcb0-8f4b-4a3e-9937-683f712ca116*/ function () {
        try {
            self.grid1.addRow();
            //self.grid1.setCellValue(self.grid1.select(), "COMPANY_CD", '5000');
            self.grid1.setCellValue(self.grid1.select(), "EMP_NO", 'jueunp'); // 사원번호
            self.grid1.setCellValue(self.grid1.select(), "KOR_NM", '박주은2'); // 성명
            self.grid1.setCellValue(self.grid1.select(), "DEPT_CD", '1000201'); // 부서코드
            self.grid1.setCellValue(self.grid1.select(), "OGRP_CD", 'C'); // 직군코드
            self.grid1.setCellValue(self.grid1.select(), "PSTN_CD", '2E'); // 직급코드
    
            self.grid1.setCellValue(self.grid1.select(), "JNCO_DT", '20220211'); // 입사일
            self.grid1.setCellValue(self.grid1.select(), "MNG_DC93", '2099-12-30'); // 승격일 ??
            self.grid1.setCellValue(self.grid1.select(), "MNG_DC50", '2099-12-31'); // 퇴직예정일 ??
            self.grid1.setCellValue(self.grid1.select(), "START_DT", '20230820'); // 시작일
            self.grid1.setCellValue(self.grid1.select(), "END_DT", '20230821'); // 종료일
    
            self.grid1.setCellValue(self.grid1.select(), "TM_CD_NM", '공통'); // 시간코드명
            self.grid1.setCellValue(self.grid1.select(), "DOF_TP", '0001'); // 휴무유형
            self.grid1.setCellValue(self.grid1.select(), "START_TM", '0100'); // 시작시간
            self.grid1.setCellValue(self.grid1.select(), "END_TM", '0230'); // 종료시간
            self.grid1.setCellValue(self.grid1.select(), "DOF_TM_CNT", '5'); // 휴무시간
            self.grid1.setCellValue(self.grid1.select(), "LVE_TM_CNT", '0'); // 이탈시간
    
            // self.grid1.setCellValue(self.grid1.select(), "INSERT_ID", 'tjqkd0912');
            // self.grid1.setCellValue(self.grid1.select(), "INSERT_IP", '192.168.0.63');
            // self.grid1.setCellValue(self.grid1.select(), "INSERT_MCADDR_NM", '');
            // self.grid1.setCellValue(self.grid1.select(), "INSERT_DTS", '2022-08-20 10:07:33.000');
    
            // self.grid1.setCellValue(self.grid1.select(), "UPDATE_ID", 'tjqkd0912');
            // self.grid1.setCellValue(self.grid1.select(), "UPDATE_IP", '192.168.0.63');
            // self.grid1.setCellValue(self.grid1.select(), "UPDATE_MCADDR_NM", '');
            // self.grid1.setCellValue(self.grid1.select(), "UPDATE_DTS", '2022-08-20 10:07:33.000');
        } catch (error) {
            console.error(error);
            dews.error(error);
        }
    });
    dews.ui.mainbuttons.search.click(/*3516b08b-047a-4054-b023-cb9f10a0b781*/ function () {
        // conditionPanel의 조회조건의 필수값 검사가 필요한경우
        if (!self.conditionpanel1.validate()) {
            return;
        }
    
        if (self.ds1.getDirtyDataCount() != 0) {
            dews.confirm('저장하지 않은 데이터가 있습니다. \n조회를 계속하시겠습니까?', 'ico2').yes(function () {
                self.ds1.read();
            }).no(function () {
                dews.ui.snackbar.warning('취소되었습니다.');
                return false;
            });
        } else {
            try {
                dews.ui.loading.show({ // 로딩화면 보여주기
                    text: '조회중입니다.'
                });
                self.ds1.read();  // 데이터소스 Read
            } catch (error) {
                dews.ui.loading.hide();
            }
        }
    });
    dews.ui.mainbuttons.delete.click(/*0776659b-4e6d-4205-ae3d-e32d41f0c831*/ function () {
        // TODO: 삭제시 강제 팝업에 대한 알림창을 끕니다.
        // self.mainButtons.delete.useDefaultConfirm = false; (preReady 단에 넣어 주었음)
        try {
            // 체크된 행 인덱스를 가진 배열
            var checkArray = self.grid1.getCheckedIndex();
    
            if (checkArray.length == 0) { // 체크된 행이 없다면
                dews.ui.snackbar.warning("체크된 행이 없습니다."); // 스낵바 경고 띄우기
                return;
            }
            //삭제에 대한 confirm icon : ico2
            dews.confirm("삭제하시겠습니까?", "ico2")
                .yes(function () {
                    // 단일행
                    // self.grid1.removeRow(self.grid1.select());
                    // 체크
                    self.grid1.removeRow(checkArray); // 체크된 행 모두 삭제하기
                    dews.ui.snackbar.info("저장을 눌러 삭제를 완료하세요.")
                });
        } catch (error) {
            console.error(error);
            dews.error(error);
        }
    });
    dews.ui.mainbuttons.save.click(/*78e0612d-4142-4edb-9167-158e5496e7a0*/ function () {
        // // TODO: 데이터소스를 저장합니다.
        if (self.ds1.getDirtyDataCount() == 0) {
            dews.alert('변경된 데이터가 없습니다.');
            return false;
        }
    
        if (self.grid1.validate({ showTooltip: true }).result == false) {
            dews.ui.snackbar.warning('필수 값이 입력되지 않은 항목이 있습니다.');
            return false;
        }
    
        try {
            // TO-BE // 아무 문제 없다면 저장 재확인하기 -> yes 누르면 창 닫고 saveData
            dews.confirm("데이터를 저장 하시겠습니까?", "ico2").yes(function (confirm) {
                confirm.on("closed", function () {
                    // // 서비스 파라미터명과 데이터소스명이 다른경우
                    // @dzParam (key를 serviceParameter라고 부름) //dews.api.post 하면 Promise 객체 반환
    
                    dews.api.post(dews.url.getApiUrl('HR', 'PAMODM01800Service', 'SSSSAAAAVVVVEEEE'), { // dews.url.getApiUrl
                        async: false,
                        data: {
                            //ServiceParameterName : ServiceParameterValue
                            saveData: JSON.stringify(self.ds1.getDirtyData()) //서비스 파라미터 명
                        }
                    }).done(function (data) {
                        dews.ui.snackbar.ok('자료가 정상적으로 저장되었습니다.');
                        self.ds1.read(); // 재조회
                    }).fail(function (xhr, status, error) {
                        //dews.error('저장이 실패하였습니다.', 'ico1');
                        dews.ui.snackbar.error(error);
                        console.error(error.responseJSON.message);
                    });
                });
            });
    
        } catch (error) {
            console.error(error);
            dews.error(error);
        }
    });
    self.ddl1.setDataSource(self.pipeData_ZC01_10005);
    dews.ui.grid(self.$grid1, {
      dataSource: self.ds1,
      editable: true,
      sortable: false,
      copyMode: 'cell',
      columns: [
        {
          field: 'EMP_NO',
          title: '사원번호',
          width: 60,
          attributes: { class: 'required' }
        },
        {
          field: 'KOR_NM',
          title: '성명',
          width: 90,
          align: 'left'
        },
        {
          field: 'DEPT_CD',
          title: '부서코드',
          width: 80
        },
        {
          field: 'OGRP_CD',
          title: '직군코드',
          width: 80
        },
        {
          field: 'PSTN_CD',
          title: '직급코드',
          width: 80
        },
        {
          field: 'JNCO_DT',
          title: '입사일',
          width: 80,
          formats: {
            type: 'date',
            format: 'yyyy-MM-dd'
          },
          editor: {
            type: 'date',
            format: 'yyyy-MM-dd'
          }
        },
        {
          field: 'MNG_DC93',
          title: '승격일',
          width: 60
        },
        {
          field: 'MNG_DC50',
          title: '퇴직예정일',
          width: 60
        },
        {
          field: 'START_DT',
          title: '시작일',
          width: 80,
          formats: {
            type: 'date',
            format: 'yyyy-MM-dd'
          },
          editor: {
            type: 'date',
            format: 'yyyy-MM-dd'
          }
        },
        {
          field: 'END_DT',
          title: '종료일',
          width: 80,
          formats: {
            type: 'date',
            format: 'yyyy-MM-dd'
          },
          editor: {
            type: 'date',
            format: 'yyyy-MM-dd'
          }
        },
        {
          field: 'TM_CD_NM',
          title: '시간코드명',
          width: 90,
          align: 'left'
        },
        {
          field: 'DOF_TP',
          title: '휴무유형',
          width: 60
        },
        {
          field: 'START_TM',
          title: '시작시간',
          width: 60
        },
        {
          field: 'END_TM',
          title: '종료시간',
          width: 60
        },
        {
          field: 'DOF_TM_CNT',
          title: '휴무시간수',
          width: 60
        },
        {
          field: 'LVE_TM_CNT',
          title: '이탈시간수',
          width: 60
        }
      ],
      fixed: {
        colCount: 0,
        rightColCount: 0
      }
    });
    
    
    
    
    

  
  });

</script>